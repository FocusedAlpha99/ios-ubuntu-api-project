# PM2 Configuration for LifeCoach iOS

## Current Status

The API server for LifeCoach iOS is configured to run 24/7 using PM2 process manager.

### Server Details
- **Process Name**: `lifecoach-ios-api`
- **Status**: ✅ Running
- **Port**: 3000
- **Auto-start**: ✅ Enabled (via systemd)
- **Auto-restart**: ✅ Enabled (on crash)
- **Started**: September 21, 2025

## PM2 Setup Commands Used

```bash
# 1. Install PM2 globally
sudo npm install -g pm2

# 2. Start the API server
pm2 start server/app.js --name lifecoach-ios-api --log-date-format "YYYY-MM-DD HH:mm:ss"

# 3. Save process list for resurrection
pm2 save

# 4. Configure auto-start on boot
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u pryzm --hp /home/pryzm
```

## Management Commands

### View Status
```bash
pm2 status
```

### View Logs
```bash
pm2 logs lifecoach-ios-api

# Or follow logs in real-time
pm2 logs lifecoach-ios-api --lines 100 -f
```

### Restart Server
```bash
pm2 restart lifecoach-ios-api
```

### Stop Server
```bash
pm2 stop lifecoach-ios-api
```

### Start Server (if stopped)
```bash
pm2 start lifecoach-ios-api
```

### Delete Process
```bash
pm2 delete lifecoach-ios-api
```

### View Detailed Info
```bash
pm2 info lifecoach-ios-api
```

### Monitor Resources
```bash
pm2 monit
```

## File Locations

- **API Server**: `/home/pryzm/ios_ubuntu_api_project/server/app.js`
- **PM2 Logs**: `/home/pryzm/.pm2/logs/`
  - Output log: `lifecoach-ios-api-out.log`
  - Error log: `lifecoach-ios-api-error.log`
- **PM2 Process File**: `/home/pryzm/.pm2/dump.pm2`
- **Systemd Service**: `/etc/systemd/system/pm2-pryzm.service`

## Systemd Integration

PM2 is integrated with systemd to ensure the server starts on boot:

```bash
# Check systemd service status
sudo systemctl status pm2-pryzm

# View systemd logs
sudo journalctl -u pm2-pryzm -f

# Restart PM2 systemd service
sudo systemctl restart pm2-pryzm
```

## Troubleshooting

### If server is not running
```bash
# Start it
pm2 start lifecoach-ios-api

# Or resurrect all saved processes
pm2 resurrect
```

### If server keeps crashing
```bash
# Check error logs
pm2 logs lifecoach-ios-api --err

# Check system resources
pm2 monit

# Increase memory limit if needed
pm2 delete lifecoach-ios-api
pm2 start server/app.js --name lifecoach-ios-api --max-memory-restart 1G
```

### If PM2 doesn't start on boot
```bash
# Re-configure startup
pm2 unstartup systemd
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u pryzm --hp /home/pryzm
pm2 save
```

## Environment Variables

The server uses a `.env` file located at:
```
/home/pryzm/ios_ubuntu_api_project/server/.env
```

Key variables:
- `PORT=3000`
- `NODE_ENV=production`
- `JWT_SECRET=<auto-generated-secure-key>`

## What This Means

✅ **You don't need to**:
- Manually start the server
- Keep terminal windows open
- Worry about crashes
- Run anything after reboot

❌ **The server will NOT**:
- Stop when you log out
- Stop when you close terminal
- Fail to restart after system reboot
- Lose configuration after updates

## Quick Health Check

```bash
# Check if API is responding
curl http://localhost:3000/api/health

# Should return:
# {
#   "status": "healthy",
#   "timestamp": "...",
#   "uptime": ...,
#   "service": "iOS Ubuntu API Backend",
#   "version": "1.0.0"
# }
```

---

*Configuration completed: September 21, 2025*
*This server runs 24/7 for the LifeCoach iOS application*